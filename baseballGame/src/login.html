<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="robots" content="index, follow"/>
  <meta name="author" content="Filip Kučera"/>
  <meta name="description" content="Login to your account."/>
  <meta name="keywords" content="2D baseball, baseball game, sport game, pixel art, baseball simulator"/>
  <meta name="theme-color" content="#4caf50"/>
  <meta name="referrer" content="no-referrer-when-downgrade" />
  <link rel="stylesheet" href="css/login.css">
  <link rel="icon" type="image/png" sizes="32x32" href="images/favicon.ico">
  <link href='https://unpkg.com/boxicons@latest/css/boxicons.min.css' rel='stylesheet'>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Jersey+10&display=swap" rel="stylesheet">
  <title>2D Baseball | Sign In</title>
</head>
<body>
  <div id="windowControls" class="windowControls">
    <button id="minimizeBtn" class="winBtn"><i class='bx  bx-minus'></i> </button>
    <button id="desktopBtn" class="winBtn"><i class='bx bx-exit-fullscreen'></i></button>
    <button id="closeBtn" class="winBtn"><i class='bx  bx-x'></i></button>
  </div>   

    <main class="auth-page">

        <div class="auth-box">
            <div id="login-result" class="result-box hidden">
                <div class="result-icon"></div>
                <p class="result-message"></p>
            </div>
            <h1>Sign In</h1>

            <form id="loginForm" class="auth-form" novalidate>

                <div class="form-group">
                    <label>Email or Username</label>
                    <input id="username" type="text" required tabindex="1">
                    <small class="error-msg"></small>
                </div>

                <div class="form-group password-group">
                    <label>Password</label>
                    <div class="password-wrapper">
                        <input id="password" type="password" required tabindex="2">
                        <span class="toggle-pass" data-state="closed">
                            <svg class="icon-eye eye-closed" viewBox="0 0 24 24">
                                <path d="M3 3l18 18M10.7 10.7a3 3 0 104.6 4.6M6.4 6.4A11.7 11.7 0 003 12c1.8 4 6 7 9 7 1.7 0 3.3-.5 4.7-1.4" stroke="#275ea7" stroke-width="2" fill="none"/>
                            </svg>
                            <svg class="icon-eye eye-open" viewBox="0 0 24 24">
                                <path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12z" stroke="#275ea7" stroke-width="2" fill="none"/>
                                <circle cx="12" cy="12" r="3" fill="#275ea7"/>
                            </svg>
                        </span>
                    </div>
                    <small class="error-msg"></small>
                </div>

                <div class="form-group">
                    <a href="https://xeon.spskladno.cz/~kuceraf/2DBaseball/baseballWeb/forgot_password" class="forgot-password">Forgot password?</a>
                </div>

                <div class="form-group remember-wrapper">
                    <label>
                        <input type="checkbox" id="remember-me" tabindex="4" name="remember-wrapper">
                        <span>Remember me</span>
                    </label>
                </div>

                <button type="submit" class="auth-btn" disabled  id="loginBtn" tabindex="5">Sign In</button>

                <p class="register-link">
                    New here? <a href="https://xeon.spskladno.cz/~kuceraf/2DBaseball/baseballWeb/register">Register here</a>
                </p>

            </form>
        </div>

    </main>
    <script src="js/login.js"></script>
    <script>
document.addEventListener("DOMContentLoaded", () => {
    const loginForm = document.getElementById("loginForm");
    const username = document.getElementById("username");
    const password = document.getElementById("password");
    const submitBtn = document.getElementById("loginBtn");
    const resultBox = document.getElementById("login-result");
    const resultIcon = resultBox.querySelector(".result-icon");
    const resultMsg  = resultBox.querySelector(".result-message");

    document.querySelectorAll(".toggle-pass").forEach(btn => {
        btn.addEventListener("click", () => {
            const input = btn.parentElement.querySelector("input");
            input.type = btn.dataset.state === "closed" ? "text" : "password";
            btn.dataset.state = btn.dataset.state === "closed" ? "open" : "closed";
        });
    });

    [username, password].forEach(input => {
        input.addEventListener("input", () => {
            validateField(input);
            checkFormValidity();
        });
        input.addEventListener("blur", () => validateField(input));
    });

    function validateField(input) {
        clearFieldError(input);
        if (!input.value.trim()) showError(input, "This field is required");
    }

    function checkFormValidity() {
        submitBtn.disabled = !username.value.trim() || !password.value.trim();
    }

    function showError(input, msg) {
        const group = input.closest(".form-group");
        const errorMsg = group.querySelector(".error-msg");
        input.classList.add("error");
        errorMsg.textContent = msg;
        errorMsg.style.opacity = 1;
    }

    function clearFieldError(input) {
        const group = input.closest(".form-group");
        const errorMsg = group.querySelector(".error-msg");
        input.classList.remove("error");
        errorMsg.textContent = "";
        errorMsg.style.opacity = 0;
    }

    function clearResultBox() {
        resultBox.style.display = "none";
        resultBox.classList.remove("error", "success");
        resultIcon.textContent = "";
        resultMsg.textContent = "";
    }

    loginForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        clearFieldError(username);
        clearFieldError(password);
        clearResultBox();

        validateField(username);
        validateField(password);

        if (submitBtn.disabled) return;

        try {
            const res = await fetch("http://localhost/PHP/2Dbaseball/baseballWeb/api/app_login.php", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ login: username.value.trim(), password: password.value })
            });

            const data = await res.json();

            if (!res.ok || !data.token) {
                resultBox.style.display = "block";
                resultBox.classList.add("error");
                resultIcon.textContent = "❌";
                resultMsg.textContent = data.message || "Login failed.";
                return;
            }

        } catch (err) {
            console.error(err);
            resultBox.style.display = "block";
            resultBox.classList.add("error");
            resultIcon.textContent = "❌";
            resultMsg.textContent = "Server error.";
        }
    });

    loginForm.addEventListener("keydown", e => {
        if (e.key === "Enter") {
            e.preventDefault();
            if (!submitBtn.disabled) loginForm.dispatchEvent(new Event("submit"));
        }
    });
});
</script>

</body>
</html>
